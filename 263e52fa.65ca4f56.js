(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{132:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/uploaded_file_big_picture-0276500d900d832c655437ef332f85cf.png"},62:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return o})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return p}));var n=a(2),r=a(6),i=(a(0),a(91)),c={title:"Files",slug:"/guides/files"},o={unversionedId:"5_Guides/5_7_Files",id:"5_Guides/5_7_Files",isDocsHomePage:!1,title:"Files",description:"Assets",source:"@site/docs/5_Guides/5_7_Files.md",slug:"/guides/files",permalink:"/symfony-boilerplate/docs/guides/files",editUrl:"https://github.com/thecodingmachine/symfony-boilerplate/docs/5_Guides/5_7_Files.md",version:"current",sidebar:"docs",previous:{title:"Emails",permalink:"/symfony-boilerplate/docs/guides/emails"},next:{title:"Overview",permalink:"/symfony-boilerplate/docs/deployments/overview"}},s=[{value:"Assets",id:"assets",children:[{value:"Web Application",id:"web-application",children:[]},{value:"API",id:"api",children:[]}]},{value:"Temporary files",id:"temporary-files",children:[]},{value:"Uploaded files",id:"uploaded-files",children:[{value:"Overview",id:"overview",children:[]},{value:"MinIO - storage service",id:"minio---storage-service",children:[]},{value:"API",id:"api-1",children:[]},{value:"Web application",id:"web-application-1",children:[]}]}],l={rightToc:s};function p(e){var t=e.components,c=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},l,c,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"assets"},"Assets"),Object(i.b)("p",null,"The application bundles assets, i.e., files like images, CSS, PDFs, etc."),Object(i.b)("h3",{id:"web-application"},"Web Application"),Object(i.b)("p",null,"The ",Object(i.b)("em",{parentName:"p"},"src/webapp/assets")," folder contains these static files. "),Object(i.b)("p",null,"The Nuxt.js server serves them to the users through their browsers."),Object(i.b)("p",null,"For instance, if you want to display an image to your users:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-vue"}),"<template>\n  <img :src=\"fooImageURL\" />\n</template>\n\n<script>\nimport fooImage from '@/assets/images/foo_image.png'\n\nexport default {\n  data() {\n    return {\n      fooImageURL: fooImage,\n    }\n  },\n}\n<\/script>\n")),Object(i.b)("h3",{id:"api"},"API"),Object(i.b)("p",null,"The ",Object(i.b)("em",{parentName:"p"},"src/api/assets")," folder contains static files, mostly for the emails."),Object(i.b)("p",null,"The Apache server from the Docker image serves them to the users through their email viewers."),Object(i.b)("h2",{id:"temporary-files"},"Temporary files"),Object(i.b)("p",null,"Your API might have to manage temporary files, i.e., files you manipulate and forget."),Object(i.b)("p",null,"An option would be to save them in the ",Object(i.b)("em",{parentName:"p"},"src/api/public")," folder (don't forget to update the ",Object(i.b)("em",{parentName:"p"},"src/api/public/.htaccess"),"\nfile for security) and delete them once your API has served them to the user."),Object(i.b)("p",null,"For instance:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php",metastring:'title="src/api/src/Infrastructure/Controller/DownloadXLSXController.php"',title:'"src/api/src/Infrastructure/Controller/DownloadXLSXController.php"'}),"protected function createResponseWithXLSXAttachment(string $filename, Xlsx $xlsx): Response\n{\n    $tmpFilename = Uuid::uuid4()->toString() . '.xlsx';\n    $xlsx->save($tmpFilename);\n    $fileContent = file_get_contents($tmpFilename); // Get the file content.\n    unlink($tmpFilename); // Delete the file.\n\n    return $this->createResponseWithAttachment(\n        $filename,\n        $fileContent\n    );\n}\n")),Object(i.b)("h2",{id:"uploaded-files"},"Uploaded files"),Object(i.b)("h3",{id:"overview"},"Overview"),Object(i.b)("p",null,Object(i.b)("img",{alt:"Uploaded files overview",src:a(132).default})),Object(i.b)("h3",{id:"minio---storage-service"},"MinIO - storage service"),Object(i.b)("p",null,"We use ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://min.io/"}),"MinIO")," as a storage service in the development environment.\nIt uses the same API as AWS S3 so that you may easily replace it with your provider's storage service in production."),Object(i.b)("p",null,"This storage is one of the steps to make the API stateless, meaning you may start/stop as many instances of your API\nwithout worrying about losing data or inconsistent behavior."),Object(i.b)("h3",{id:"api-1"},"API"),Object(i.b)("p",null,"Like the ",Object(i.b)("inlineCode",{parentName:"p"},"Models")," and ",Object(i.b)("inlineCode",{parentName:"p"},"DAOs")," classes for the data, we provide ",Object(i.b)("inlineCode",{parentName:"p"},"Storables")," and ",Object(i.b)("inlineCode",{parentName:"p"},"Storages")," classes for the uploaded files."),Object(i.b)("p",null,"For instance, a ",Object(i.b)("em",{parentName:"p"},"src/api/src/Domain/Model/Product.php")," can have pictures."),Object(i.b)("p",null,"We created a ",Object(i.b)("em",{parentName:"p"},"src/api/src/Domain/Model/Storable/ProductPicture.php"),"\nclass that represents a picture."),Object(i.b)("p",null,"It extends from the ",Object(i.b)("em",{parentName:"p"},"src/api/src/Domain/Model/Storable/Storable.php")," class."),Object(i.b)("p",null,"Your ",Object(i.b)("inlineCode",{parentName:"p"},"Storable")," classes have to implement the ",Object(i.b)("inlineCode",{parentName:"p"},"getExtension")," method from the ",Object(i.b)("inlineCode",{parentName:"p"},"Storable")," class to validate the files' extensions."),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","You may also add your methods with validation annotations."))),Object(i.b)("h4",{id:"create-a-storable-from-a-source"},"Create a storable from a source"),Object(i.b)("p",null,"A ",Object(i.b)("inlineCode",{parentName:"p"},"Storable")," contains useful methods for creating one or more instances according to a source:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"use App\\Domain\\Model\\Storable\\ProductPicture;\nuse Psr\\Http\\Message\\UploadedFileInterface;\n\n$storable = ProductPicture::createFromUploadedFile(\n    /** @var UploadedFileInterface $picture */\n   $picture\n);\n\n$storables = ProductPicture::createAllFromUploadedFiles(\n    /** @var UploadedFileInterface[] $pictures */\n   $pictures\n);\n\n$storable = ProductPicture::createFromPath(\n    /** @var string $picture */\n   $picture\n);\n\n$storables = ProductPicture::createAllFromPaths(\n    /** @var string[] $pictures */\n   $pictures\n);\n")),Object(i.b)("h4",{id:"write-a-storable-to-a-storage"},"Write a storable to a storage"),Object(i.b)("p",null,"Pictures being public, we created a ",Object(i.b)("em",{parentName:"p"},"src/api/src/Domain/Storage/ProductPictureStorage.php"),"\nclass that extends the ",Object(i.b)("em",{parentName:"p"},"src/api/src/Domain/Storage/PublicStorage.php")," class."),Object(i.b)("p",null,"For private files, the storage should extend the ",Object(i.b)("em",{parentName:"p"},"src/api/src/Domain/Storage/PrivateStorage.php")," class."),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","Both ",Object(i.b)("inlineCode",{parentName:"p"},"PublicStorage")," and ",Object(i.b)("inlineCode",{parentName:"p"},"PrivateStorage")," classes extend the ",Object(i.b)("em",{parentName:"p"},"src/api/src/Domain/Storage/Storage/Storage.php")," class."))),Object(i.b)("h5",{id:"usage"},"Usage"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"$storable = ProductPicture::createFromUploadedFile(\n    /** @var UploadedFileInterface $picture */\n   $picture\n);\n$filename = $this->productPictureStorage->write($storable);\n$product->setPicture($filename);\n\n\n$storables = ProductPicture::createAllFromUploadedFiles(\n    /** @var UploadedFileInterface[] $pictures */\n   $pictures\n);\n$filenames = $this->productPictureStorage->writeAll($storables);\n$product->setPictures($filenames);\n")),Object(i.b)("p",null,"As you can see, the ",Object(i.b)("inlineCode",{parentName:"p"},"ProductPicture")," class is only useful for uploading the file to the storage.\nYour ",Object(i.b)("inlineCode",{parentName:"p"},"Models")," must save the random filename(s) returned by the ",Object(i.b)("inlineCode",{parentName:"p"},"Storage")," methods."),Object(i.b)("p",null,"The methods ",Object(i.b)("inlineCode",{parentName:"p"},"write")," and ",Object(i.b)("inlineCode",{parentName:"p"},"writeAll")," also validate the storable. If invalid, it throws a\n",Object(i.b)("em",{parentName:"p"},"src/api/src/Domain/Throwable/InvalidStorable.php")," exception. We will see how to handle this exception on\nthe web application after."),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","Your ",Object(i.b)("inlineCode",{parentName:"p"},"Storages")," must implement the ",Object(i.b)("inlineCode",{parentName:"p"},"getDirectoryName")," method\nfrom the ",Object(i.b)("inlineCode",{parentName:"p"},"Storage")," class. In the storage service's bucket, it is the directory's name, which contains the files."))),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","We recommend using a Symfony parameter to hold a public directory name (coming itself from an environment variable).\nIndeed, the web application will need to know the directory name to create the public URL to the files\nfrom this directory, so it is better to use the same variable for your ",Object(i.b)("inlineCode",{parentName:"p"},"api")," and ",Object(i.b)("inlineCode",{parentName:"p"},"webapp")," services."))),Object(i.b)("h4",{id:"delete-a-storable-from-a-storage"},"Delete a storable from a storage"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"$filename = $product->getPicture();\n$this->productPictureStorage->delete($filename);\n\n$filenames = $product->getPictures();\n$this->productPictureStorage->deleteAll($filenames);\n")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","If you have a lot of files to delete, it might be better to do that action asynchronously.\nSee ",Object(i.b)("em",{parentName:"p"},"src/api/src/UseCase/Product/DeleteProduct.php"),"."))),Object(i.b)("h4",{id:"serve-a-private-file"},"Serve a private file"),Object(i.b)("p",null,"Public files are accessible from the storage service URL directly, but that's not the case for private files."),Object(i.b)("p",null,"You must create a ",Object(i.b)("inlineCode",{parentName:"p"},"Controller")," with a Symfony route. Your controller will extend\nthe ",Object(i.b)("em",{parentName:"p"},"src/api/src/Infrastructure/Controller/DownloadController.php")," class that provides\na ",Object(i.b)("inlineCode",{parentName:"p"},"createResponseWithAttachment")," method."),Object(i.b)("p",null,"See ",Object(i.b)("em",{parentName:"p"},"src/api/src/Infrastructure/Controller/Order/OrderInvoiceController.php")," for a complete example."),Object(i.b)("h4",{id:"configuration"},"Configuration"),Object(i.b)("p",null,"We use ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/thephpleague/flysystem"}),"Flysystem")," to abstract the storage service in our source code."),Object(i.b)("p",null,"We configured this package in the ",Object(i.b)("em",{parentName:"p"},"src/api/config/packages/flysystem.yaml")," configuration file."),Object(i.b)("p",null,"There are two kinds of storage:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Public for files available to everyone."),Object(i.b)("li",{parentName:"ul"},"Private for files requiring access control.")),Object(i.b)("p",null,"In our implementation with ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://min.io/"}),"MinIO"),", we use two buckets (sort of disks with access policies)."),Object(i.b)("p",null,"We create the two buckets thanks to the ",Object(i.b)("em",{parentName:"p"},"src/api/src/Infrastructure/Command/InitializeS3StorageCommand.php")," command:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash",metastring:'title="console"',title:'"console"'}),"php bin/console app:init-storage:s3\n")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","In your development environment, the service ",Object(i.b)("inlineCode",{parentName:"p"},"api")," runs this command automatically on startup."))),Object(i.b)("p",null,"Let's go back to the configuration:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml",metastring:'title="src/api/config/packages/flysystem.yaml"',title:'"src/api/config/packages/flysystem.yaml"'}),"public.storage.s3:\n    adapter: 'aws'\n    options:\n        client: 's3.client'\n        bucket: '%env(STORAGE_PUBLIC_BUCKET)%'\n\npublic.storage.memory:\n    adapter: 'memory'\n\npublic.storage:\n    adapter: 'lazy'\n    options:\n        source: '%env(STORAGE_PUBLIC_SOURCE)%'\n")),Object(i.b)("p",null,"The service ",Object(i.b)("inlineCode",{parentName:"p"},"public.storage")," is the generic Symfony service used in our source code.\nThanks to its ",Object(i.b)("inlineCode",{parentName:"p"},"source")," option, we tell the Flysystem package to use either the ",Object(i.b)("inlineCode",{parentName:"p"},"public.storage.s3")," service\n(development, maybe other environments) or ",Object(i.b)("inlineCode",{parentName:"p"},"public.storage.memory")," service (tests)."),Object(i.b)("p",null,"It works the same for private storage."),Object(i.b)("h3",{id:"web-application-1"},"Web application"),Object(i.b)("h4",{id:"public-file-url"},"Public file URL"),Object(i.b)("p",null,"In the ",Object(i.b)("inlineCode",{parentName:"p"},"publicRuntimeConfig")," property of your ",Object(i.b)("em",{parentName:"p"},"src/webapp/nuxt.config.js"),", you can\nadd base URLs of your public bucket's directories. For instance:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-js",metastring:'title="src/webapp/nuxt.config.js"',title:'"src/webapp/nuxt.config.js"'}),"publicRuntimeConfig: {\n  productPictureURL:\n    process.env.PUBLIC_STORAGE_URL +\n    process.env.PUBLIC_STORAGE_PRODUCT_PICTURE +\n    '/',\n}\n")),Object(i.b)("p",null,"You may then concatenate the filename to this URL in your ",Object(i.b)("inlineCode",{parentName:"p"},"<script>")," blocks:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-vue"}),"this.$config.productPictureURL + this.product.picture\n")),Object(i.b)("p",null,"Or in your template:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-vue"}),'<template>\n    <img :src="$config.productPictureURL + product.picture" />\n</template>\n')),Object(i.b)("h4",{id:"private-file-url"},"Private file URL"),Object(i.b)("p",null,"Use the ",Object(i.b)("inlineCode",{parentName:"p"},"$config.apiURL")," and concatenate the Symfony route of your Controller."),Object(i.b)("h4",{id:"uploads"},"Uploads"),Object(i.b)("p",null,"Examples:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Create: ",Object(i.b)("em",{parentName:"li"},"src/webapp/pages/products/create/_companyId.vue"),"."),Object(i.b)("li",{parentName:"ul"},"Update: ",Object(i.b)("em",{parentName:"li"},"src/webapp/pages/products/_id/edit.vue"),".")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","In case of ",Object(i.b)("inlineCode",{parentName:"p"},"InvalidStorable"),", errors are available under the directory name key (i.e., for product pictures\nits ",Object(i.b)("inlineCode",{parentName:"p"},"product_picture"),")."))))}p.isMDXComponent=!0},91:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},b=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),b=p(a),d=n,u=b["".concat(c,".").concat(d)]||b[d]||m[d]||i;return a?r.a.createElement(u,o(o({ref:t},l),{},{components:a})):r.a.createElement(u,o({ref:t},l))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,c=new Array(i);c[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:n,c[1]=o;for(var l=2;l<i;l++)c[l]=a[l];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);