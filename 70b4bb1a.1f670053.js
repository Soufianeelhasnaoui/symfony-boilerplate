(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{73:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return r})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return l}));var n=a(2),i=a(6),o=(a(0),a(91)),c={title:"Database",slug:"/api/database"},r={unversionedId:"3_API/3_3_Database",id:"3_API/3_3_Database",isDocsHomePage:!1,title:"Database",description:"The boilerplate uses TDBM as ORM. It is an alternative to Doctrine or Eloquent,",source:"@site/docs/3_API/3_3_Database.md",slug:"/api/database",permalink:"/symfony-boilerplate/docs/api/database",editUrl:"https://github.com/thecodingmachine/symfony-boilerplate/docs/3_API/3_3_Database.md",version:"current",sidebar:"docs",previous:{title:"Configuration",permalink:"/symfony-boilerplate/docs/api/configuration"},next:{title:"Static Analysis",permalink:"/symfony-boilerplate/docs/api/static-analysis"}},s=[{value:"Migrations",id:"migrations",children:[{value:"Create a migration",id:"create-a-migration",children:[]},{value:"Apply migrations",id:"apply-migrations",children:[]},{value:"Generate PHP classes",id:"generate-php-classes",children:[]}]},{value:"Models",id:"models",children:[{value:"Create an instance",id:"create-an-instance",children:[]}]},{value:"DAOs",id:"daos",children:[{value:"Save / update",id:"save--update",children:[]},{value:"Delete",id:"delete",children:[]},{value:"Get by",id:"get-by",children:[]},{value:"Find all",id:"find-all",children:[]},{value:"Find",id:"find",children:[]}]},{value:"Development data",id:"development-data",children:[]}],b={rightToc:s};function l(e){var t=e.components,a=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"The boilerplate uses ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/thecodingmachine/tdbm"}),"TDBM")," as ORM. It is an alternative to Doctrine or Eloquent,\nyet it is pretty close."),Object(o.b)("p",null,"The main difference is that with TDBM, you write your database's tables first before generating your models."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","All commands have to be run in the ",Object(o.b)("inlineCode",{parentName:"p"},"api")," service (",Object(o.b)("inlineCode",{parentName:"p"},"make api"),")."))),Object(o.b)("h2",{id:"migrations"},"Migrations"),Object(o.b)("p",null,"TDBM integrates well with Symfony, as you are able to use the\n",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://symfony.com/doc/current/bundles/DoctrineMigrationsBundle/index.html"}),"DoctrineMigrationsBundle"),"."),Object(o.b)("p",null,"TDBM provides wrappers around this library for:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Building your database structure with fluid schemas (i.e., ",Object(o.b)("inlineCode",{parentName:"li"},"$x->foo()->bar()->baz()"),")."),Object(o.b)("li",{parentName:"ol"},"Defining your GraphQL types and their fields.")),Object(o.b)("h3",{id:"create-a-migration"},"Create a migration"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash",metastring:'title="console"',title:'"console"'}),"php bin/console doctrine:migrations:generate\n")),Object(o.b)("p",null,"This command will generate a new empty migration in the ",Object(o.b)("em",{parentName:"p"},"src/api/migrations")," folder."),Object(o.b)("p",null,"Add a meaningful description:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php",metastring:'title="Migration"',title:'"Migration"'}),"public function getDescription() : string\n{\n    return 'Create X, Y and Z tables.';\n}\n")),Object(o.b)("p",null,"And throw the following exception the ",Object(o.b)("inlineCode",{parentName:"p"},"down")," method:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php",metastring:'title="Migration"',title:'"Migration"'}),"public function down(Schema $schema) : void\n{\n    throw new RuntimeException('Never rollback a migration!');\n}\n")),Object(o.b)("p",null,"You may now update the ",Object(o.b)("inlineCode",{parentName:"p"},"up")," method. For instance:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php",metastring:'title="src/api/migrations/Version20200424093138.php"',title:'"src/api/migrations/Version20200424093138.php"'}),"declare(strict_types=1);\n\nnamespace DoctrineMigrations;\n\nuse Doctrine\\DBAL\\Schema\\Schema;\nuse Doctrine\\Migrations\\AbstractMigration;\nuse RuntimeException;\nuse TheCodingMachine\\FluidSchema\\TdbmFluidSchema;\n\n/**\n * Auto-generated Migration: Please modify to your needs!\n */\nfinal class Version20200424093138 extends AbstractMigration\n{\n    public function getDescription(): string\n    {\n        return 'Create companies and users tables.';\n    }\n\n    public function up(Schema $schema): void\n    {\n        $db = new TdbmFluidSchema($schema);\n\n        $db->table('companies')\n            ->column('id')->guid()->primaryKey()->comment('@UUID')->graphqlField()\n            ->column('name')->string(255)->notNull()->graphqlField();\n\n        $db->table('users')\n            ->column('id')->guid()->primaryKey()->comment('@UUID')->graphqlField()\n            ->column('company_id')->references('company_id')->notNull()->graphqlField()\n            ->column('first_name')->string(255)->notNull()->graphqlField()\n            ->column('last_name')->string(255)->notNull()->graphqlField()\n            ->column('email')->string(255)->notNull()->->unique()->graphqlField()\n            ->column('password')->string(255)->null()->default(null);\n    }\n\n    public function down(Schema $schema): void\n    {\n        throw new RuntimeException('Never rollback a migration!');\n    }\n}\n")),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","A table name should be plural."))),Object(o.b)("p",null,"If you're updating an existing table, it would be better to edit the corresponding migration instead of creating\na new migration."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","You should ",Object(o.b)("strong",{parentName:"p"},"only")," do that if a remote environment like your production did not already apply the migration."))),Object(o.b)("h3",{id:"apply-migrations"},"Apply migrations"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash",metastring:'title="console"',title:'"console"'}),"php bin/console doctrine:migrations:migrate -n\n")),Object(o.b)("p",null,"This command will apply the new migrations to the database."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","In development, the ",Object(o.b)("inlineCode",{parentName:"p"},"api")," service does it on startup."))),Object(o.b)("p",null,"If you've edited an existing migration, you'll have to reset the database first:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash",metastring:'title="console"',title:'"console"'}),"php bin/console doctrine:database:drop -n --force &&\nphp bin/console doctrine:database:create -n &&\nphp bin/console doctrine:migrations:migrate -n\n")),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","Reminder: you should ",Object(o.b)("strong",{parentName:"p"},"only")," do that if a remote environment like your production did not already apply the migration."))),Object(o.b)("h3",{id:"generate-php-classes"},"Generate PHP classes"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash",metastring:'title="console"',title:'"console"'}),"php bin/console tdbm:generate\n")),Object(o.b)("p",null,"This command will regenerate the TDBM ",Object(o.b)("inlineCode",{parentName:"p"},"Models")," and ",Object(o.b)("inlineCode",{parentName:"p"},"DAOs"),"."),Object(o.b)("h2",{id:"models"},"Models"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"Models")," come in two kinds of classes. For instance:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("em",{parentName:"li"},"src/api/src/Domain/Model/Generated/BaseUser.php")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("em",{parentName:"li"},"src/api/src/Domain/Model/User.php"))),Object(o.b)("p",null,"TDBM generates the first class, and it contains the default getters and setters."),Object(o.b)("p",null,"You cannot modify it, but instead, edit the second class as TDBM does not override it."),Object(o.b)("p",null,"The second class is where you should put your validation annotations. More on that subject in the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/guides/validation"}),"Validation"),"\nguide."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","There are other kinds of classes in the ",Object(o.b)("em",{parentName:"p"},"src/api/src/Domain/Model")," folder (",Object(o.b)("inlineCode",{parentName:"p"},"Storables")," for instance), but\nthey are not related to TDBM."))),Object(o.b)("h3",{id:"create-an-instance"},"Create an instance"),Object(o.b)("p",null,"Let's say you have a model ",Object(o.b)("inlineCode",{parentName:"p"},"Foo")," with the following properties:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"bar"),", non-nullable."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"baz"),", nullable.")),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"$foo = new Foo($bar);\n$foo->setBaz($baz);\n")),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","A constructor of a model requires non-nullable values."))),Object(o.b)("h2",{id:"daos"},"DAOs"),Object(o.b)("p",null,"Like ",Object(o.b)("inlineCode",{parentName:"p"},"Models"),", TDBM generates two kinds of classes. For instance:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("em",{parentName:"li"},"src/api/src/Domain/Dao/Generated/BaseUserDao.php")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("em",{parentName:"li"},"src/api/src/Domain/Dao/UserDao.php"))),Object(o.b)("p",null,"The first class contains most of the methods allowing you to interact with the corresponding table in the database."),Object(o.b)("p",null,"You cannot modify it, but instead, edit the second class as TDBM does not override it."),Object(o.b)("h3",{id:"save--update"},"Save / update"),Object(o.b)("p",null,"The base ",Object(o.b)("inlineCode",{parentName:"p"},"DAO")," provides a method ",Object(o.b)("inlineCode",{parentName:"p"},"save")," which takes the ",Object(o.b)("inlineCode",{parentName:"p"},"Model")," instance as parameter:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"$foo = new Foo($bar);\n$this->fooDao->save($foo);\n\n$foo->setBaz($baz);\n$this->fooDao->save($foo);\n")),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","TDBM generates the primary key."))),Object(o.b)("p",null,"As you might validate this ",Object(o.b)("inlineCode",{parentName:"p"},"Model")," instance, you should override this method in your ",Object(o.b)("inlineCode",{parentName:"p"},"DAO"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php",metastring:'title="src/api/src/Domain/Dao/FooDao.php"',title:'"src/api/src/Domain/Dao/FooDao.php"'}),"namespace App\\Domain\\Dao;\n\nuse App\\Domain\\Dao\\Generated\\BaseFooDao;\nuse App\\Domain\\Model\\Foo;\nuse App\\Domain\\Throwable\\InvalidModel;\nuse Symfony\\Component\\Validator\\Validator\\ValidatorInterface;\nuse TheCodingMachine\\TDBM\\TDBMService;\n\nclass FooDao extends BaseFoorDao\n{\n    private ValidatorInterface $validator;\n\n    public function __construct(TDBMService $tdbmService, ValidatorInterface $validator)\n    {\n        $this->validator = $validator;\n        parent::__construct($tdbmService);\n    }\n\n    /**\n     * @throws InvalidModel\n     */\n    public function validate(Foo $foo): void\n    {\n        $violations = $this->validator->validate($foo);\n        InvalidModel::throwException($violations);\n    }\n\n    /**\n     * @throws InvalidModel\n     */\n    public function save(Foo $foo): void\n    {\n        $this->validate($user);\n        parent::save($user);\n    }\n}\n")),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","Now, wherever you call the ",Object(o.b)("inlineCode",{parentName:"p"},"save")," method, your DAO will validate the ",Object(o.b)("inlineCode",{parentName:"p"},"Model")," data."))),Object(o.b)("h3",{id:"delete"},"Delete"),Object(o.b)("p",null,"The base ",Object(o.b)("inlineCode",{parentName:"p"},"DAO")," provides a method ",Object(o.b)("inlineCode",{parentName:"p"},"delete")," which takes the ",Object(o.b)("inlineCode",{parentName:"p"},"Model")," instance as parameter:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"$this->foodDao->delete($foo);\n")),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","This method also takes a boolean argument for cascade deletion. However, it would be best to handle such\na scenario using composition (see ",Object(o.b)("em",{parentName:"p"},"src/api/src/UseCase/Company/DeleteCompany.php"),")."))),Object(o.b)("h3",{id:"get-by"},"Get by"),Object(o.b)("p",null,"The base ",Object(o.b)("inlineCode",{parentName:"p"},"DAO")," provides methods for retrieving a model from the primary key and unique properties:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"$foo = $this->fooDao->getById($id);\n")),Object(o.b)("h3",{id:"find-all"},"Find all"),Object(o.b)("p",null,"The base ",Object(o.b)("inlineCode",{parentName:"p"},"DAO")," provides the method ",Object(o.b)("inlineCode",{parentName:"p"},"findAll"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"$foos = $this->fooDao->findAll();\n")),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","This method returns a ",Object(o.b)("inlineCode",{parentName:"p"},"ResultIterator"),", a sort of array of instances. See the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/guides/lists"}),"Lists"),"\nguide for more details."))),Object(o.b)("h3",{id:"find"},"Find"),Object(o.b)("p",null,"The base ",Object(o.b)("inlineCode",{parentName:"p"},"DAO")," provides the method ",Object(o.b)("inlineCode",{parentName:"p"},"find"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"$foos = $this->fooDao->find(\n    [\n        'bar LIKE :bar OR baz = :baz',\n    ],\n    [\n        'bar' => '%' . $bar . '%',\n        'baz' => $baz,\n    ],\n    'id ASC'\n);\n")),Object(o.b)("p",null,"The first argument is the ",Object(o.b)("inlineCode",{parentName:"p"},"WHERE")," clause."),Object(o.b)("p",null,"The second argument is the parameters of the ",Object(o.b)("inlineCode",{parentName:"p"},"WHERE")," clause."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","If a parameter's value is ",Object(o.b)("inlineCode",{parentName:"p"},"null"),", TDBM automatically removes the corresponding conditions in the first\nargument."))),Object(o.b)("p",null,"The third argument is the sort order and direction."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"\ud83d\udce3","\xa0","\xa0","This method returns a ",Object(o.b)("inlineCode",{parentName:"p"},"ResultIterator"),", a sort of array of instances. See the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/guides/lists"}),"Lists"),"\nguide for more details."))),Object(o.b)("h2",{id:"development-data"},"Development data"),Object(o.b)("p",null,"The ",Object(o.b)("em",{parentName:"p"},"src/api/src/Infrastructure/Command/DevFixturesCommand.php")," class provides a Symfony command for initializing your\ndevelopment database with dummy data:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash",metastring:'title="console"',title:'"console"'}),"php bin/console app:fixtures:dev\n")),Object(o.b)("p",null,"It uses the class ",Object(o.b)("em",{parentName:"p"},"src/api/src/Infrastructure/Fixtures/AppFixtures.php")," for that task."),Object(o.b)("p",null,"You should edit according to your needs."))}l.isMDXComponent=!0},91:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return h}));var n=a(0),i=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var b=i.a.createContext({}),l=function(e){var t=i.a.useContext(b),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},d=function(e){var t=l(e.components);return i.a.createElement(b.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},m=i.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,c=e.parentName,b=s(e,["components","mdxType","originalType","parentName"]),d=l(a),m=n,h=d["".concat(c,".").concat(m)]||d[m]||p[m]||o;return a?i.a.createElement(h,r(r({ref:t},b),{},{components:a})):i.a.createElement(h,r({ref:t},b))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,c=new Array(o);c[0]=m;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:n,c[1]=r;for(var b=2;b<o;b++)c[b]=a[b];return i.a.createElement.apply(null,c)}return i.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);